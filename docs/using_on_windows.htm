<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Using ArrayFire with Microsoft Windows and Visual Studio</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="afw.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="arrayfire.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="arrayfire_logo.png"/>
  </td>
	 <td id="gsearch">
   <div><script>
	    (function() {
        var cx = '004356362924927882526:zup3ehe-7bs';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
	    var s = document.getElementsByTagName('script')[0];
	    s.parentNode.insertBefore(gcse, s);
	  })();
  </script>
  <gcse:search></gcse:search>
</div>
	 </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.htm"><span>Main&#160;Page</span></a></li>
      <li><a href="usergroup0.htm"><span>Tutorials</span></a></li>
      <li><a href="modules.htm"><span>Functions</span></a></li>
      <li><a href="releasenotes.htm"><span>Release&#160;Notes</span></a></li>
      <li><a href="examples.htm"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('using_on_windows.htm','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Using ArrayFire with Microsoft Windows and Visual Studio </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>If you have not already done so, please make sure you have installed, configured, and tested ArrayFire following the <a class="el" href="installing.htm">installation instructions</a>.</p>
<h2>The big picture</h2>
<p>The ArrayFire Windows installer creates the following:</p><ol type="1">
<li><code>AF_PATH</code> environment variable to point to the installation location. The default install location is <code>C:\Program Files\ArrayFire\v3</code></li>
<li><code>AF_PATH/include</code> : Header files for ArrayFire (include directory)</li>
<li><code>AF_PATH/lib</code> : All ArrayFire backends libraries, dlls and dependency dlls (library directory)</li>
<li><code>AF_PATH/examples</code> : Examples to get started. Some examples also have pre-built exectuables</li>
<li><code>AF_PATH/cmake</code> : CMake config files for automatic configuration by external projects</li>
<li><code>AF_PATH/uninstall.exe</code> : Uninstaller</li>
<li><code>AF_PATH/*</code> : Other miscellenous files including licenses, logos, copyrights</li>
</ol>
<p>The installer also appends <code>%AF_PATH%/lib</code> to the User PATH variable.</p>
<p>To add <code>%AF_PATH%/lib</code> to PATH for all users see the windows section in <a class="el" href="installing.htm">installation instructions</a>.</p>
<h3><a class="anchor" id="nvvm_dlls"></a>Dealing with CUDA NMMV DLLs</h3>
<p>When using CUDA with ArrayFire you may encounter a linker error indicating the NVVM DLLs are missing. This is because the NVVM DLLs are not part of the standard <code>CUDA_PATH\bin</code> installation directory that is added to your <code>PATH</code> when the CUDA installer runs. Thus, NVVM will not be found during runtime. There are a few ways to deal with this issue:</p>
<ol type="1">
<li>Copy the DLLs to the exectuable location. This is, by far, the cleanest solution and we recommend doing this with ArrayFire projects. To do so, create a post-build event to copy the NVVM DLL as discusses below in <a href="#s3partA">Step 3 - Part A</a>.</li>
<li>Copy <code>CUDA_PATH\nvvm\bin\nvvm64_30_0.dll</code> to <code>CUDA_PATH\bin</code>. This is a one time copy such that the NVVM DLL is now with all the other CUDA dlls and in a directory that is a part of PATH and hence the DLL can be detected automatically.</li>
<li>Add <code>%CUDA_PATH%\nvvm\bin</code> to the system PATH environment variable. This will allow automatic detection by the system and No further copying will be required. ArrayFire does not add this to PATH since the CUDA installer doesn't add it to PATH.</li>
</ol>
<h2><a class="anchor" id="step1"></a>Step 1: Running pre-built executables</h2>
<p>The ArrayFire installer ships with a few pre-built executables with the examples. These should run out of the box when double clicked.</p>
<p>Some prebuilt examples are:</p><ul>
<li>Helloworld (examples/helloworld)</li>
<li>BLAS (examples/benchmarks)</li>
<li>FFT (examples/benchmarks)</li>
<li>Pi Estimation (examples/benchmarks)</li>
<li>Conway (Graphics) (examples/graphics)</li>
</ul>
<p>Note: For the CUDA executables, you will need to copy <code>CUDA_PATH\nvvm\bin\nvvm64_30_0.dll</code> to the location of the executables.</p>
<h2><a class="anchor" id="step2"></a>Step 2: Build and Run a Project</h2>
<ol type="1">
<li>Open Visual Studio 2013. Load the HelloWorld solution which is located at <code>AF_PATH/examples/helloworld/helloworld.sln</code>.</li>
<li>Build the <code>helloworld</code> example. Be sure to, select the platform/configuration of your choice using the platform drop-down (the options are CPU, CUDA, OpenCL, and Unified) and Solution Configuration drop down (options of Release and Debug) menus.</li>
<li>Run the <code>helloworld</code> example.</li>
</ol>
<h2><a class="anchor" id="step3"></a>Step 3: Using ArrayFire within Visual Studio</h2>
<p>This is divided into 4 parts:</p><ul>
<li><a href="#s3partA">Part A: Adding ArrayFire to an existing solution (Single Backend)</a></li>
<li><a href="#s3partB">Part B: Adding ArrayFire CUDA to a new/existing CUDA project</a></li>
<li><a href="#s3partC">Part C: Project with all ArrayFire backends</a></li>
<li><a href="#s3partD">Part D: ArrayFire with CMake</a></li>
</ul>
<h3><a class="anchor" id="s3partA"></a>Part A: Adding ArrayFire to an existing solution (Single Backend)</h3>
<p>Note: If you plan on using Native CUDA code in the project, use the steps under <a href="#s3partB">Part B</a>.</p>
<p>Adding a single backend to an existing project is quite simple.</p>
<ol type="1">
<li>Add <code>"$(AF_PATH)/include;"</code> to <em>Project Properties -&gt; C/C++ -&gt; General -&gt; Additional Include Directories</em>.</li>
<li>Add <code>"$(AF_PATH)/lib;"</code> to <em>Project Properties -&gt; Linker -&gt; General -&gt; Additional Library Directories</em>.</li>
<li>Add <code>afcpu.lib</code> or <code>afcuda.lib</code> or <code>afopencl.lib</code> to <em>Project Properties -&gt; Linker -&gt; Input -&gt; Additional Dependencies</em>. based on your preferred backend.</li>
<li>(Optional) You may choose to define <code>NOMINMAX</code>, <code>AF_&lt;CPU/CUDA/OPENCL&gt;</code> and/or <code>AF_&lt;DEBUG/RELEASE&gt;</code> in your projects. This can be added to <em>Project Properties -&gt; C/C++ -&gt; General -&gt; Preprocessor-&gt; Preprocessory definitions</em>.</li>
</ol>
<p>If you are using the CUDA backend, it is important to ensure that the CUDA NVVM DLLs are copied to the exectuable directory. This can be done by adding a post build event.</p>
<p>Open the <em>Project Properties -&gt; Build Events -&gt; Post Build Events</em> dialog and add the following lines to it. </p><div class="fragment"><div class="line">echo <a class="code" href="group__index__func__index.htm#ga25f470817062b23ad3f74347ea44b17c">copy</a> <span class="stringliteral">&quot;$(CUDA_PATH)\nvvm\bin\nvvm64*.dll&quot;</span> <span class="stringliteral">&quot;$(OutDir)&quot;</span></div>
<div class="line"><a class="code" href="group__index__func__index.htm#ga25f470817062b23ad3f74347ea44b17c">copy</a> <span class="stringliteral">&quot;$(CUDA_PATH)\nvvm\bin\nvvm64*.dll&quot;</span> <span class="stringliteral">&quot;$(OutDir)&quot;</span></div>
</div><!-- fragment --><h3><a class="anchor" id="s3partB"></a>Part B: Adding ArrayFire CUDA to a new/existing CUDA project</h3>
<p>Lastly, if your project contains custom CUDA code, the instructions are slightly different as it requires using a CUDA NVCC Project:</p>
<ol type="1">
<li>Create a custom "CUDA NVCC project" in Visual Studio</li>
<li>Add <code>"$(AF_PATH)/include;"</code> to <em>Project Properties -&gt; CUDA C/C++ -&gt; General -&gt; Additional Include Directories</em>.</li>
<li>Add <code>"$(AF_PATH)/lib;"</code> to <em>Project Properties -&gt; Linker -&gt; General -&gt; Additional Library Directories</em>.</li>
<li>Add <code>afcpu.lib</code> or <code>afcuda.lib</code> or <code>afopencl.lib</code> to <em>Project Properties -&gt; Linker -&gt; Input -&gt; Additional Dependencies</em>. based on your preferred backend.</li>
<li>(Optional) You may choose to define <code>NOMINMAX</code>, <code>AF_CUDA</code> and/or <code>AF_&lt;DEBUG/RELEASE&gt;</code> in your projects. This can be added to <em>Project Properties -&gt; C/C++ -&gt; General -&gt; Preprocessor-&gt; Preprocessory definitions</em>.</li>
<li>Pick a solution to handle the NVVM DLLs. We recommend the post build event method used in <a href="#s3partA">Part A</a>.</li>
</ol>
<h3><a class="anchor" id="s3partC"></a>Part C: Project with all ArrayFire backends</h3>
<p>If you wish to create a project that allows you to use all the ArrayFire backends with ease, the best way to go is to copy the <em>HelloWorld sln/vcxproj/cpp</em> file trio and rename them to suit your project.</p>
<p>All the ArrayFire examples are pre-configured for all ArrayFire backends as well as the Unified API. These can be chosen from the Solution/Platform configuration drop down boxes.</p>
<p>You can alternately download the template project from <a href="https://github.com/arrayfire/arrayfire-project-templates">ArrayFire Template Projects</a></p>
<h3><a class="anchor" id="s3partD"></a>Part D: ArrayFire with CMake</h3>
<p><em>NOTE:</em> The ArrayFire installer sets up CMake file and registry so that it can be found by CMake by simply using the <code>Find_PACKAGE(ArrayFire)</code> command.</p>
<p>If you are writing a new ArrayFire project in C/C++ from scratch, we suggest you grab a copy of our <a href="https://github.com/arrayfire/arrayfire-project-templates">CMake Project Example</a>; however, it is useful to read the documentation below in case you need to add ArrayFire to an existing project.</p>
<p>As <a href="#big-picture">discussed above</a>, ArrayFire ships with a series of CMake scripts to make finding and using our library easy. The scripts will automatically find all versions of the ArrayFire library and pick the most powerful of the installed backends (typically CUDA).</p>
<p>First create a file called <code>CMakeLists.txt</code> in your project directory: </p><pre class="fragment">cd your-project-directory
touch CMakeLists.txt
</pre><p>and populate it with the following code: </p><pre class="fragment">FIND_PACKAGE(ArrayFire)
INCLUDE_DIRECTORIES(${ArrayFire_INCLUDE_DIRS})

... [gather source files, etc.]

# If you intend to use OpenCL, you need to find it
FIND_PACKAGE(OpenCL)
SET(EXTRA_LIBS ${CMAKE_THREAD_LIBS_INIT} ${OpenCL_LIBRARIES})

# Or if you intend to use CUDA, you need it as well as NVVM:
FIND_PACKAGE(CUDA)
FIND_PACKAGE(NVVM) # this FIND script can be found in the ArrayFire CMake example repository
SET(EXTRA_LIBS ${CMAKE_THREAD_LIBS_INIT} ${CUDA_LIBRARIES} ${NVVM_LIB})

ADD_EXECUTABLE(my_executable [list your source files here])
TARGET_LINK_LIBRARIES(my_executable ${ArrayFire_LIBRARIES} ${EXTRA_LIBS})
</pre><p>where <code>my_executable</code> is the name of the executable you wish to create. See the <a href="https://cmake.org/documentation/">CMake documentation</a> for more information on how to use CMake. Clearly the above code snippet precludes the use of both CUDA and OpenCL, see the <a href="https://github.com/arrayfire/arrayfire-project-templates/tree/master/CMake">ArrayFire CMake Example</a> for an example of how to build executables for both backends from the same CMake script.</p>
<p>In the above code listing, the <code>FIND_PACKAGE</code> will find the ArrayFire include files, libraries, and define several variables including: </p><pre class="fragment">ArrayFire_INCLUDE_DIRS    - Location of ArrayFire's include directory.
ArrayFire_LIBRARIES       - Location of ArrayFire's libraries.
                            This will default to a GPU backend if one
                            is found
ArrayFire_FOUND           - True if ArrayFire has been located
</pre><p>If you wish to use a specific backend, the find script also defines these variables: </p><pre class="fragment">ArrayFire_CPU_FOUND         - True of the ArrayFire CPU library has been found.
ArrayFire_CPU_LIBRARIES     - Location of ArrayFire's CPU library, if found
ArrayFire_CUDA_FOUND        - True of the ArrayFire CUDA library has been found.
ArrayFire_CUDA_LIBRARIES    - Location of ArrayFire's CUDA library, if found
ArrayFire_OpenCL_FOUND      - True of the ArrayFire OpenCL library has been found.
ArrayFire_OpenCL_LIBRARIES  - Location of ArrayFire's OpenCL library, if found
ArrayFire_Unified_FOUND     - True of the ArrayFire Unified library has been found.
ArrayFire_Unified_LIBRARIES - Location of ArrayFire's Unified library, if found
</pre><p>Therefore, if you wish to target a specific specific backend, simply replace <code>${ArrayFire_LIBRARIES}</code> with <code>${ArrayFire_CPU}</code>, <code>${ArrayFire_OPENCL}</code>, <code>${ArrayFire_CUDA}</code>, or <code>${ArrayFire_Unified}</code> in the <code>TARGET_LINK_LIBRARIES</code> command above.</p>
<p>Next we need to instruct CMake to create build instructions and then compile. We suggest using CMake's out-of-source build functionality to keep your build and source files cleanly separated. To do this open the CMake GUI.</p>
<ul>
<li>Under source directory, add the path to your project</li>
<li>Under build directory, add the path to your project and append /build</li>
<li>Click configure and choose Visual Studio 2013 Win 64 as the generator.</li>
<li>If configuration was successful, click generate. This will create a my-project.sln file under build. You can open this in Visual Studio and compile the ALL_BUILD project.</li>
</ul>
<p>The <a href="https://github.com/arrayfire/arrayfire-project-templates/tree/master/CMake">ArrayFire CMake Example</a> is a CMake project used to demo how ArrayFire can be using with a CMake project.</p>
<p>Note: The CMake project does not add the post build event to copy the NVVM DLLs in case of CUDA backend. You will need to either copy it manually to the exectuable directory, or pick another solution for it. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
</div>
</div>
</div>
</div>
</div>
<!--Google Analytics-->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5076919-1']);
  _gaq.push(['_setDomainName', '.arrayfire.com']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!--Spectate-->
<script type="text/javascript">
  sAId = "151";
  sCId = "688";
  (function() {
    function async_load(){
      var s = document.createElement('script'); s.type = 'text/javascript';
      s.src = (('https:' == document.location.protocol) ? "https://ssl" : "http://cdn") + ".spectate.com/s.js";
      var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
    }
    if(window.attachEvent) { window.attachEvent('onload', async_load); }
    else { window.addEventListener('load', async_load, false); }
  })();
</script>
<!--Adroll-->
<script type="text/javascript">
adroll_adv_id = "ZRWI4W4RTRHENOWGXZY5JQ";
adroll_pix_id = "QLXGBK3MSFB6LOL6PES2MT";
(function () {
var oldonload = window.onload;
window.onload = function(){
   __adroll_loaded=true;
   var scr = document.createElement("script");
   var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
   scr.setAttribute('async', 'true');
   scr.type = "text/javascript";
   scr.src = host + "/j/roundtrip.js";
   ((document.getElementsByTagName('head') || [null])[0] ||
    document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
   if(oldonload){oldonload()}};
}());
</script>
</body>
</html>
